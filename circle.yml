dependencies:
  post:
    - "gem install gem-versioner -v 1.1.0"
  override:
    - rvm-exec 2.2.2 bundle install -j 4
    - rvm-exec 2.2.2 bundle exec appraisal install -j 4
    - rvm-exec 2.3.1 bundle install -j 4
    - rvm-exec 2.3.1 bundle exec appraisal install -j 4
test:
  override:
    - RACK_ENV=development rvm-exec 2.2.2 bundle exec appraisal rspec
    - RACK_ENV=production  rvm-exec 2.2.2 bundle exec appraisal rspec
    - RACK_ENV=development rvm-exec 2.3.1 bundle exec appraisal rspec
    - RACK_ENV=production  rvm-exec 2.3.1 bundle exec appraisal rspec
    - rvm-exec 2.2.2 bundle exec rubocop
deployment:
  gemfury:
    tag: /.*/
    commands:
      - "gem build loga.gemspec"
      - "curl -F package=@$(ls -t1 loga-*.gem | head -1) ${GEMFURY_PUSH_URI}"
  dev:
    branch: /^(?!master$).*/
    commands:
      - "PRE_RELEASE=$CIRCLE_BRANCH gem build loga.gemspec"
      - "curl -F package=@$(ls -t1 loga-*.gem | head -1) ${GEMFURY_PUSH_URI}"
