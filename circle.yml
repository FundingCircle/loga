dependencies:
  override:
    - rvm-exec 2.2.5 bundle install -j 4
    - rvm-exec 2.2.5 bundle exec appraisal install -j 4
    - rvm-exec 2.3.1 bundle install -j 4
    - rvm-exec 2.3.1 bundle exec appraisal install -j 4
test:
  override:
    - RACK_ENV=development rvm-exec 2.2.5 bundle exec appraisal rspec
    - RACK_ENV=production  rvm-exec 2.2.5 bundle exec appraisal rspec
    - RACK_ENV=development rvm-exec 2.3.1 bundle exec appraisal rspec
    - RACK_ENV=production  rvm-exec 2.3.1 bundle exec appraisal rspec
    - rvm-exec 2.3.1 bundle exec rubocop
    - rvm-exec 2.3.1 bundle exec codeclimate-test-reporter
deployment:
  rubygems:
    tag: /^v\d.+/
    owner: FundingCircle
    commands:
      - "gem build $CIRCLE_PROJECT_REPONAME.gemspec"
      - 'echo :rubygems_api_key: ${RUBYGEMS_API_KEY} >  ~/.gem/credentials'
      - "chmod 0600 ~/.gem/credentials"
      - "gem push $CIRCLE_PROJECT_REPONAME-$(echo $CIRCLE_TAG | sed -e 's/v//').gem"
